#summary 溫度監控範例程式的說明

= Introduction =

在[http://code.google.com/p/kittybee/downloads/detail?name=temp_sensing_demo.rar&can=2&q= 溫度監控網路sample code] 裏有device端( 溫度sensor)跟接收端的程式 

*temp_sensing_NSS* 是sensor 端的程式

*Coor_LCD_NSS* 是接收端的程式

兩者都會用到 Arduino NewSoftwareSerial的 library 來跟KKittyBee做溝通, 這樣可以保留原來的UART做為debug 跟程式下載用

請到這裏下載 [http://arduiniana.org/NewSoftSerial/NewSoftSerial10c.zip NewSoftwareSerial], 解開後放到 Arduino 下的libraries 資料夾裏面( 例如在022的版本裏是\arduino-0022\libraries)


*在進行實做前, 請務必先看完前面幾篇基礎:

 # 使用10K NTC來量測溫度, 請參考wiki裏的[KnowingTempWithArduinoAndNTC]
 # 建立一個3節點的基礎ZigBee網路[SetUpSimpleZigBeeNetwork] 
 # 網路中資料傳輸的方法 [PassingDataInKittyBee]
 # 把要傳輸的資料做簡單的封包[SimpleDataFrame]




= Details =
* 溫度量測端  *temp_sensing_NSS.pde* 

Device Nr 這裏是在開始的宣告裏寫好的,所以第一個sensor跟第二個sensor要改好再compile 您也可以修改成用dip switch或其他方式來決定
{{{
int device_Nr=1;
//int device_Nr=2;
}}}

接下來我們include NewSoftSerial, D2為RX, D3為TX
math.h 是NTC計算溫度時用的

在 setup()裏我們把兩個serial 都宣告成38400,這部分也可以自己更改, 不過myserial() 這個SoftwareSerial 是拿來接KittyBee, KittyBee UART的default值是38400, 如果這裡更改了, 那KittyBee的baudrate也要修改, 建議都維持38400
{{{
#include <NewSoftSerial.h>
NewSoftSerial mySerial(2, 3);//2 as RX,3 as TX
#include <math.h>

void setup()
{
Serial.begin(38400); 
  mySerial.begin(38400);
}
}}}
在 *temp_sensing_NSS* 裏面, 我們用[KnowingTempWithArduinoAndNTC]裏說的方法用10K NTC 量測出現有的溫度, T10_C 則把浮點的小數(溫度), 乘以10 再取整數, 方便我們以2 bytes來傳輸
{{{
 T10_C =  int(Thermister(analogRead(0))*10.)  ;
}}}

接下來用[SimpleDataFrame]裏講述的方法把device Nr跟T10_C形成簡單的封包

{{{ 
form_array();
}}}

把形成的封包從SoftWareSerial(D3 pin)傳給KittyBee

最後將T10_C從Arduino的TX(D1 pin)傳出, 方便從電腦上看到溫度是不是有正確

{{{
for(int i=0;i<12;i++){
  mySerial.print(arrayData[i]);
}
  Serial.println(T10_C); 
}}}

如果NTC的接法正確, 應該可以從Arduino IDE的 Serial Monitor裏看到攝氏溫度的10倍, 例如: 225 就是22.5度C

*溫度感測端如果要多個, 請務必記得Device Nr要跟著修改, 這裡我們做兩個, Device Nr分別是1跟2*